// 语言包字典
const i18n = {
  "zh-CN": {
    nav_general: "常规设置",
    nav_rules: "分类规则",
    btn_import: "导入配置",
    btn_export: "导出配置",
    btn_save: "保存所有",
    section_unmatched: "未匹配文件处理",
    desc_unmatched: "当下载的文件不符合任何分类规则时，该如何处理？",
    label_action: "处理方式",
    opt_root: "保留在下载根目录",
    opt_folder: "移动到指定文件夹",
    label_folder_name: "文件夹名称",
    desc_rules: "点击卡片编辑规则。未匹配的文件将按常规设置处理。",
    btn_add_rule: "新增分类",
    modal_edit_title: "编辑分类",
    modal_add_title: "新增分类",
    label_name: "分类名称 (显示用)",
    label_folder: "文件夹名称 (实际路径)",
    label_exts: "扩展名 (英文逗号分隔)",
    tip_folder: "文件将保存在 Downloads/此文件夹/",
    tip_exts: "例如: jpg, png, gif",
    btn_delete: "删除分类",
    btn_cancel: "取消",
    btn_confirm: "确定",
    msg_saved: "规则已保存，下次下载时生效",
    msg_imported: "配置导入成功",
    msg_import_err: "导入失败，格式错误",
    rule_Images: "图片",
    rule_Documents: "文档",
    rule_Videos: "视频",
    rule_Audio: "音乐",
    rule_Archives: "压缩包",
    rule_Apps: "应用安装包"
  },
  "zh-TW": {
    nav_general: "常規設置",
    nav_rules: "分類規則",
    btn_import: "導入配置",
    btn_export: "導出配置",
    btn_save: "保存所有",
    section_unmatched: "未匹配文件處理",
    desc_unmatched: "當下載的文件不符合任何分類規則時，該如何處理？",
    label_action: "處理方式",
    opt_root: "保留在下載根目錄",
    opt_folder: "移動到指定文件夾",
    label_folder_name: "文件夾名稱",
    desc_rules: "點擊卡片編輯規則。未匹配的文件將按常規設置處理。",
    btn_add_rule: "新增分類",
    modal_edit_title: "編輯分類",
    modal_add_title: "新增分類",
    label_name: "分類名稱 (顯示用)",
    label_folder: "文件夾名稱 (實際路徑)",
    label_exts: "擴展名 (英文逗號分隔)",
    tip_folder: "文件將保存在 Downloads/此文件夾/",
    tip_exts: "例如: jpg, png, gif",
    btn_delete: "刪除分類",
    btn_cancel: "取消",
    btn_confirm: "確定",
    msg_saved: "規則已保存，下次下載時生效",
    msg_imported: "配置導入成功",
    msg_import_err: "導入失敗，格式錯誤",
    rule_Images: "圖片",
    rule_Documents: "文檔",
    rule_Videos: "視頻",
    rule_Audio: "音樂",
    rule_Archives: "壓縮包",
    rule_Apps: "應用安裝包"
  },
  "en": {
    nav_general: "General",
    nav_rules: "Rules",
    btn_import: "Import",
    btn_export: "Export",
    btn_save: "Save All",
    section_unmatched: "Unmatched Files",
    desc_unmatched: "How to handle files that don't match any rules?",
    label_action: "Action",
    opt_root: "Stay in Root Folder",
    opt_folder: "Move to Folder",
    label_folder_name: "Folder Name",
    desc_rules: "Click cards to edit. Unmatched files follow General settings.",
    btn_add_rule: "Add Category",
    modal_edit_title: "Edit Category",
    modal_add_title: "Add Category",
    label_name: "Label Name",
    label_folder: "Folder Path",
    label_exts: "Extensions (comma separated)",
    tip_folder: "Saved to Downloads/ThisFolder/",
    tip_exts: "e.g. jpg, png, gif",
    btn_delete: "Delete",
    btn_cancel: "Cancel",
    btn_confirm: "Confirm",
    msg_saved: "Settings Saved",
    msg_imported: "Imported Successfully",
    msg_import_err: "Import Failed",
    rule_Images: "Images",
    rule_Documents: "Documents",
    rule_Videos: "Videos",
    rule_Audio: "Music",
    rule_Archives: "Archives",
    rule_Apps: "Applications"
  },
  "ja": {
    nav_general: "一般設定",
    nav_rules: "分類ルール",
    btn_import: "インポート",
    btn_export: "エクスポート",
    btn_save: "すべて保存",
    section_unmatched: "未分類ファイル",
    desc_unmatched: "ルールに一致しないファイルをどう処理しますか？",
    label_action: "処理方法",
    opt_root: "ダウンロードフォルダに保存",
    opt_folder: "指定フォルダに移動",
    label_folder_name: "フォルダ名",
    desc_rules: "カードをクリックして編集。未分類は一般設定に従います。",
    btn_add_rule: "カテゴリ追加",
    modal_edit_title: "カテゴリ編集",
    modal_add_title: "カテゴリ追加",
    label_name: "表示名",
    label_folder: "フォルダパス",
    label_exts: "拡張子 (カンマ区切り)",
    tip_folder: "保存先: Downloads/フォルダ名/",
    tip_exts: "例: jpg, png, gif",
    btn_delete: "削除",
    btn_cancel: "キャンセル",
    btn_confirm: "確定",
    msg_saved: "設定を保存しました",
    msg_imported: "インポート成功",
    msg_import_err: "インポート失敗",
    rule_Images: "画像",
    rule_Documents: "ドキュメント",
    rule_Videos: "動画",
    rule_Audio: "音楽",
    rule_Archives: "圧縮ファイル",
    rule_Apps: "アプリ"
  },
  "ko": {
    nav_general: "일반 설정",
    nav_rules: "분류 규칙",
    btn_import: "가져오기",
    btn_export: "내보내기",
    btn_save: "모두 저장",
    section_unmatched: "미분류 파일",
    desc_unmatched: "규칙과 일치하지 않는 파일은 어떻게 처리합니까?",
    label_action: "처리 방식",
    opt_root: "다운로드 폴더에 유지",
    opt_folder: "지정 폴더로 이동",
    label_folder_name: "폴더 이름",
    desc_rules: "카드를 클릭하여 편집하세요. 미분류 파일은 일반 설정을 따릅니다.",
    btn_add_rule: "카테고리 추가",
    modal_edit_title: "카테고리 편집",
    modal_add_title: "카테고리 추가",
    label_name: "표시 이름",
    label_folder: "폴더 경로",
    label_exts: "확장자 (쉼표로 구분)",
    tip_folder: "저장 위치: Downloads/폴더명/",
    tip_exts: "예: jpg, png, gif",
    btn_delete: "삭제",
    btn_cancel: "취소",
    btn_confirm: "확인",
    msg_saved: "설정이 저장되었습니다",
    msg_imported: "가져오기 성공",
    msg_import_err: "가져오기 실패",
    rule_Images: "이미지",
    rule_Documents: "문서",
    rule_Videos: "동영상",
    rule_Audio: "음악",
    rule_Archives: "압축 파일",
    rule_Apps: "애플리케이션"
  },
  "fr": {
    nav_general: "Général",
    nav_rules: "Règles",
    btn_import: "Importer",
    btn_export: "Exporter",
    btn_save: "Enregistrer",
    section_unmatched: "Fichiers non classés",
    desc_unmatched: "Comment gérer les fichiers sans règle correspondante ?",
    label_action: "Action",
    opt_root: "Laisser dans le dossier racine",
    opt_folder: "Déplacer vers un dossier",
    label_folder_name: "Nom du dossier",
    desc_rules: "Cliquez pour éditer. Les fichiers non classés suivent les règles générales.",
    btn_add_rule: "Ajouter une catégorie",
    modal_edit_title: "Modifier la catégorie",
    modal_add_title: "Ajouter une catégorie",
    label_name: "Nom d'affichage",
    label_folder: "Chemin du dossier",
    label_exts: "Extensions (séparées par des virgules)",
    tip_folder: "Enregistré dans : Downloads/Dossier/",
    tip_exts: "ex : jpg, png, gif",
    btn_delete: "Supprimer",
    btn_cancel: "Annuler",
    btn_confirm: "Confirmer",
    msg_saved: "Paramètres enregistrés",
    msg_imported: "Importation réussie",
    msg_import_err: "Échec de l'importation",
    rule_Images: "Images",
    rule_Documents: "Documents",
    rule_Videos: "Vidéos",
    rule_Audio: "Musique",
    rule_Archives: "Archives",
    rule_Apps: "Applications"
  },
  "es": {
    nav_general: "General",
    nav_rules: "Reglas",
    btn_import: "Importar",
    btn_export: "Exportar",
    btn_save: "Guardar",
    section_unmatched: "Archivos sin clasificar",
    desc_unmatched: "¿Cómo manejar archivos que no coinciden con ninguna regla?",
    label_action: "Acción",
    opt_root: "Mantener en carpeta raíz",
    opt_folder: "Mover a carpeta",
    label_folder_name: "Nombre de la carpeta",
    desc_rules: "Haga clic para editar. Los archivos no coincidentes siguen la configuración general.",
    btn_add_rule: "Añadir categoría",
    modal_edit_title: "Editar categoría",
    modal_add_title: "Añadir categoría",
    label_name: "Nombre visible",
    label_folder: "Ruta de la carpeta",
    label_exts: "Extensiones (separadas por comas)",
    tip_folder: "Guardado en: Downloads/Carpeta/",
    tip_exts: "ej: jpg, png, gif",
    btn_delete: "Eliminar",
    btn_cancel: "Cancelar",
    btn_confirm: "Confirmar",
    msg_saved: "Configuración guardada",
    msg_imported: "Importación exitosa",
    msg_import_err: "Error en la importación",
    rule_Images: "Imágenes",
    rule_Documents: "Documentos",
    rule_Videos: "Vídeos",
    rule_Audio: "Música",
    rule_Archives: "Archivos",
    rule_Apps: "Aplicaciones"
  },
  "ar": {
    nav_general: "إعدادات عامة",
    nav_rules: "قواعد التصنيف",
    btn_import: "استيراد",
    btn_export: "تصدير",
    btn_save: "حفظ الكل",
    section_unmatched: "الملفات غير المصنفة",
    desc_unmatched: "كيف يتم التعامل مع الملفات التي لا تطابق أي قاعدة؟",
    label_action: "الإجراء",
    opt_root: "إبقاء في المجلد الرئيسي",
    opt_folder: "نقل إلى مجلد",
    label_folder_name: "اسم المجلد",
    desc_rules: "انقر للتعديل. الملفات غير المطابقة تتبع الإعدادات العامة.",
    btn_add_rule: "إضافة فئة",
    modal_edit_title: "تعديل الفئة",
    modal_add_title: "إضافة فئة",
    label_name: "اسم العرض",
    label_folder: "مسار المجلد",
    label_exts: "الامتدادات (مفصولة بفواصل)",
    tip_folder: "مكان الحفظ: Downloads/Folder/",
    tip_exts: "مثال: jpg, png, gif",
    btn_delete: "حذف",
    btn_cancel: "إلغاء",
    btn_confirm: "تأكيد",
    msg_saved: "تم حفظ الإعدادات",
    msg_imported: "تم الاستيراد بنجاح",
    msg_import_err: "فشل الاستيراد",
    rule_Images: "صور",
    rule_Documents: "مستندات",
    rule_Videos: "فيديو",
    rule_Audio: "صوتيات",
    rule_Archives: "أرشيف",
    rule_Apps: "تطبيقات"
  },
  "pt": {
    nav_general: "Geral",
    nav_rules: "Regras",
    btn_import: "Importar",
    btn_export: "Exportar",
    btn_save: "Salvar",
    section_unmatched: "Arquivos não correspondentes",
    desc_unmatched: "Como lidar com arquivos sem regras?",
    label_action: "Ação",
    opt_root: "Manter na raiz",
    opt_folder: "Mover para pasta",
    label_folder_name: "Nome da pasta",
    desc_rules: "Clique para editar. Arquivos sem regra seguem a configuração geral.",
    btn_add_rule: "Adicionar Categoria",
    modal_edit_title: "Editar Categoria",
    modal_add_title: "Adicionar Categoria",
    label_name: "Nome de exibição",
    label_folder: "Caminho da pasta",
    label_exts: "Extensões (separadas por vírgula)",
    tip_folder: "Salvo em: Downloads/Pasta/",
    tip_exts: "ex: jpg, png, gif",
    btn_delete: "Excluir",
    btn_cancel: "Cancelar",
    btn_confirm: "Confirmar",
    msg_saved: "Configurações salvas",
    msg_imported: "Importado com sucesso",
    msg_import_err: "Falha na importação",
    rule_Images: "Imagens",
    rule_Documents: "Documentos",
    rule_Videos: "Vídeos",
    rule_Audio: "Música",
    rule_Archives: "Arquivos",
    rule_Apps: "Aplicativos"
  },
  "ru": {
    nav_general: "Общие",
    nav_rules: "Правила",
    btn_import: "Импорт",
    btn_export: "Экспорт",
    btn_save: "Сохранить",
    section_unmatched: "Несоответствующие файлы",
    desc_unmatched: "Как обрабатывать файлы без правил?",
    label_action: "Действие",
    opt_root: "Оставить в корне",
    opt_folder: "Переместить в папку",
    label_folder_name: "Имя папки",
    desc_rules: "Нажмите для редактирования. Остальные файлы следуют общим настройкам.",
    btn_add_rule: "Добавить категорию",
    modal_edit_title: "Редактировать категорию",
    modal_add_title: "Добавить категорию",
    label_name: "Отображаемое имя",
    label_folder: "Путь к папке",
    label_exts: "Расширения (через запятую)",
    tip_folder: "Сохранено в: Downloads/Папка/",
    tip_exts: "например: jpg, png, gif",
    btn_delete: "Удалить",
    btn_cancel: "Отмена",
    btn_confirm: "Подтвердить",
    msg_saved: "Настройки сохранены",
    msg_imported: "Импорт выполнен",
    msg_import_err: "Ошибка импорта",
    rule_Images: "Изображения",
    rule_Documents: "Документы",
    rule_Videos: "Видео",
    rule_Audio: "Музыка",
    rule_Archives: "Архивы",
    rule_Apps: "Приложения"
  },
  "de": {
    nav_general: "Allgemein",
    nav_rules: "Regeln",
    btn_import: "Importieren",
    btn_export: "Exportieren",
    btn_save: "Speichern",
    section_unmatched: "Nicht zugeordnete Dateien",
    desc_unmatched: "Wie sollen Dateien ohne Regel behandelt werden?",
    label_action: "Aktion",
    opt_root: "Im Stammverzeichnis behalten",
    opt_folder: "In Ordner verschieben",
    label_folder_name: "Ordnername",
    desc_rules: "Zum Bearbeiten klicken. Nicht zugeordnete Dateien folgen den allgemeinen Einstellungen.",
    btn_add_rule: "Kategorie hinzufügen",
    modal_edit_title: "Kategorie bearbeiten",
    modal_add_title: "Kategorie hinzufügen",
    label_name: "Anzeigename",
    label_folder: "Ordnerpfad",
    label_exts: "Erweiterungen (kommagetrennt)",
    tip_folder: "Gespeichert in: Downloads/Ordner/",
    tip_exts: "z.B. jpg, png, gif",
    btn_delete: "Löschen",
    btn_cancel: "Abbrechen",
    btn_confirm: "Bestätigen",
    msg_saved: "Einstellungen gespeichert",
    msg_imported: "Erfolgreich importiert",
    msg_import_err: "Import fehlgeschlagen",
    rule_Images: "Bilder",
    rule_Documents: "Dokumente",
    rule_Videos: "Videos",
    rule_Audio: "Musik",
    rule_Archives: "Archive",
    rule_Apps: "Anwendungen"
  },
  "id": {
    nav_general: "Umum",
    nav_rules: "Aturan",
    btn_import: "Impor",
    btn_export: "Ekspor",
    btn_save: "Simpan",
    section_unmatched: "File Tak Cocok",
    desc_unmatched: "Bagaimana menangani file yang tidak cocok dengan aturan?",
    label_action: "Tindakan",
    opt_root: "Tetap di Folder Unduhan",
    opt_folder: "Pindahkan ke Folder",
    label_folder_name: "Nama Folder",
    desc_rules: "Klik untuk mengedit. File tak cocok mengikuti pengaturan umum.",
    btn_add_rule: "Tambah Kategori",
    modal_edit_title: "Edit Kategori",
    modal_add_title: "Tambah Kategori",
    label_name: "Nama Tampilan",
    label_folder: "Jalur Folder",
    label_exts: "Ekstensi (dipisahkan koma)",
    tip_folder: "Disimpan ke: Downloads/Folder/",
    tip_exts: "cth: jpg, png, gif",
    btn_delete: "Hapus",
    btn_cancel: "Batal",
    btn_confirm: "Konfirmasi",
    msg_saved: "Pengaturan Disimpan",
    msg_imported: "Berhasil Diimpor",
    msg_import_err: "Gagal Mengimpor",
    rule_Images: "Gambar",
    rule_Documents: "Dokumen",
    rule_Videos: "Video",
    rule_Audio: "Musik",
    rule_Archives: "Arsip",
    rule_Apps: "Aplikasi"
  },
  "th": {
    nav_general: "ทั่วไป",
    nav_rules: "กฎ",
    btn_import: "นำเข้า",
    btn_export: "ส่งออก",
    btn_save: "บันทึก",
    section_unmatched: "ไฟล์ที่ไม่ตรงกัน",
    desc_unmatched: "จัดการไฟล์ที่ไม่ตรงกับกฎอย่างไร?",
    label_action: "การกระทำ",
    opt_root: "เก็บไว้ในโฟลเดอร์หลัก",
    opt_folder: "ย้ายไปยังโฟลเดอร์",
    label_folder_name: "ชื่อโฟลเดอร์",
    desc_rules: "คลิกเพื่อแก้ไข ไฟล์ที่ไม่ตรงกันจะทำตามการตั้งค่าทั่วไป",
    btn_add_rule: "เพิ่มหมวดหมู่",
    modal_edit_title: "แก้ไขหมวดหมู่",
    modal_add_title: "เพิ่มหมวดหมู่",
    label_name: "ชื่อที่แสดง",
    label_folder: "เส้นทางโฟลเดอร์",
    label_exts: "นามสกุล (คั่นด้วยจุลภาค)",
    tip_folder: "บันทึกไปที่: Downloads/Folder/",
    tip_exts: "เช่น jpg, png, gif",
    btn_delete: "ลบ",
    btn_cancel: "ยกเลิก",
    btn_confirm: "ยืนยัน",
    msg_saved: "บันทึกการตั้งค่าแล้ว",
    msg_imported: "นำเข้าสำเร็จ",
    msg_import_err: "นำเข้าล้มเหลว",
    rule_Images: "รูปภาพ",
    rule_Documents: "เอกสาร",
    rule_Videos: "วิดีโอ",
    rule_Audio: "เพลง",
    rule_Archives: "ไฟล์บีบอัด",
    rule_Apps: "แอพพลิเคชั่น"
  },
  "vi": {
    nav_general: "Chung",
    nav_rules: "Quy tắc",
    btn_import: "Nhập",
    btn_export: "Xuất",
    btn_save: "Lưu",
    section_unmatched: "Tệp không khớp",
    desc_unmatched: "Xử lý các tệp không khớp với quy tắc như thế nào?",
    label_action: "Hành động",
    opt_root: "Giữ ở thư mục gốc",
    opt_folder: "Di chuyển đến thư mục",
    label_folder_name: "Tên thư mục",
    desc_rules: "Nhấp để chỉnh sửa. Tệp không khớp theo cài đặt chung.",
    btn_add_rule: "Thêm danh mục",
    modal_edit_title: "Sửa danh mục",
    modal_add_title: "Thêm danh mục",
    label_name: "Tên hiển thị",
    label_folder: "Đường dẫn thư mục",
    label_exts: "Phần mở rộng (cách nhau bởi dấu phẩy)",
    tip_folder: "Lưu vào: Downloads/Folder/",
    tip_exts: "vd: jpg, png, gif",
    btn_delete: "Xóa",
    btn_cancel: "Hủy",
    btn_confirm: "Xác nhận",
    msg_saved: "Đã lưu cài đặt",
    msg_imported: "Nhập thành công",
    msg_import_err: "Nhập thất bại",
    rule_Images: "Hình ảnh",
    rule_Documents: "Tài liệu",
    rule_Videos: "Video",
    rule_Audio: "Nhạc",
    rule_Archives: "Lưu trữ",
    rule_Apps: "Ứng dụng"
  },
  "tr": {
    nav_general: "Genel",
    nav_rules: "Kurallar",
    btn_import: "İçe Aktar",
    btn_export: "Dışa Aktar",
    btn_save: "Kaydet",
    section_unmatched: "Eşleşmeyen Dosyalar",
    desc_unmatched: "Herhangi bir kurala uymayan dosyalar nasıl işlenir?",
    label_action: "Eylem",
    opt_root: "Kök Klasörde Tut",
    opt_folder: "Klasöre Taşı",
    label_folder_name: "Klasör Adı",
    desc_rules: "Düzenlemek için tıklayın. Eşleşmeyen dosyalar genel ayarları izler.",
    btn_add_rule: "Kategori Ekle",
    modal_edit_title: "Kategoriyi Düzenle",
    modal_add_title: "Kategori Ekle",
    label_name: "Görünen Ad",
    label_folder: "Klasör Yolu",
    label_exts: "Uzantılar (virgülle ayrılmış)",
    tip_folder: "Kaydedildi: Downloads/Folder/",
    tip_exts: "örn: jpg, png, gif",
    btn_delete: "Sil",
    btn_cancel: "İptal",
    btn_confirm: "Onayla",
    msg_saved: "Ayarlar Kaydedildi",
    msg_imported: "Başarıyla İçe Aktarıldı",
    msg_import_err: "İçe Aktarma Başarısız",
    rule_Images: "Resimler",
    rule_Documents: "Belgeler",
    rule_Videos: "Videolar",
    rule_Audio: "Müzik",
    rule_Archives: "Arşivler",
    rule_Apps: "Uygulamalar"
  },
  "it": {
    nav_general: "Generale",
    nav_rules: "Regole",
    btn_import: "Importa",
    btn_export: "Esporta",
    btn_save: "Salva",
    section_unmatched: "File non corrispondenti",
    desc_unmatched: "Come gestire i file che non corrispondono a nessuna regola?",
    label_action: "Azione",
    opt_root: "Mantieni nella cartella principale",
    opt_folder: "Sposta in cartella",
    label_folder_name: "Nome cartella",
    desc_rules: "Clicca per modificare. I file non corrispondenti seguono le impostazioni generali.",
    btn_add_rule: "Aggiungi Categoria",
    modal_edit_title: "Modifica Categoria",
    modal_add_title: "Aggiungi Categoria",
    label_name: "Nome visualizzato",
    label_folder: "Percorso cartella",
    label_exts: "Estensioni (separate da virgola)",
    tip_folder: "Salvato in: Downloads/Cartella/",
    tip_exts: "es: jpg, png, gif",
    btn_delete: "Elimina",
    btn_cancel: "Annulla",
    btn_confirm: "Conferma",
    msg_saved: "Impostazioni salvate",
    msg_imported: "Importato con successo",
    msg_import_err: "Importazione fallita",
    rule_Images: "Immagini",
    rule_Documents: "Documenti",
    rule_Videos: "Video",
    rule_Audio: "Musica",
    rule_Archives: "Archivi",
    rule_Apps: "Applicazioni"
  },
  "pl": {
    nav_general: "Ogólne",
    nav_rules: "Reguły",
    btn_import: "Importuj",
    btn_export: "Eksportuj",
    btn_save: "Zapisz",
    section_unmatched: "Niepasujące pliki",
    desc_unmatched: "Jak obsługiwać pliki, które nie pasują do żadnych reguł?",
    label_action: "Akcja",
    opt_root: "Zostaw w folderze głównym",
    opt_folder: "Przenieś do folderu",
    label_folder_name: "Nazwa folderu",
    desc_rules: "Kliknij, aby edytować. Niepasujące pliki podlegają ustawieniom ogólnym.",
    btn_add_rule: "Dodaj Kategorię",
    modal_edit_title: "Edytuj Kategorię",
    modal_add_title: "Dodaj Kategorię",
    label_name: "Nazwa wyświetlana",
    label_folder: "Ścieżka folderu",
    label_exts: "Rozszerzenia (oddzielone przecinkami)",
    tip_folder: "Zapisano w: Downloads/Folder/",
    tip_exts: "np: jpg, png, gif",
    btn_delete: "Usuń",
    btn_cancel: "Anuluj",
    btn_confirm: "Potwierdź",
    msg_saved: "Ustawienia zapisane",
    msg_imported: "Pomyślnie zaimportowano",
    msg_import_err: "Import nieudany",
    rule_Images: "Obrazy",
    rule_Documents: "Dokumenty",
    rule_Videos: "Wideo",
    rule_Audio: "Muzyka",
    rule_Archives: "Archiwa",
    rule_Apps: "Aplikacje"
  },
  "nl": {
    nav_general: "Algemeen",
    nav_rules: "Regels",
    btn_import: "Importeren",
    btn_export: "Exporteren",
    btn_save: "Opslaan",
    section_unmatched: "Niet-overeenkomende bestanden",
    desc_unmatched: "Hoe om te gaan met bestanden die niet overeenkomen met regels?",
    label_action: "Actie",
    opt_root: "In hoofdmap bewaren",
    opt_folder: "Verplaatsen naar map",
    label_folder_name: "Mapnaam",
    desc_rules: "Klik om te bewerken. Niet-overeenkomende bestanden volgen algemene instellingen.",
    btn_add_rule: "Categorie toevoegen",
    modal_edit_title: "Categorie bewerken",
    modal_add_title: "Categorie toevoegen",
    label_name: "Weergavenaam",
    label_folder: "Mappad",
    label_exts: "Extensies (komma gescheiden)",
    tip_folder: "Opgeslagen in: Downloads/Map/",
    tip_exts: "bijv: jpg, png, gif",
    btn_delete: "Verwijderen",
    btn_cancel: "Annuleren",
    btn_confirm: "Bevestigen",
    msg_saved: "Instellingen opgeslagen",
    msg_imported: "Succesvol geïmporteerd",
    msg_import_err: "Import mislukt",
    rule_Images: "Afbeeldingen",
    rule_Documents: "Documenten",
    rule_Videos: "Video's",
    rule_Audio: "Muziek",
    rule_Archives: "Archieven",
    rule_Apps: "Applicaties"
  },
  "sv": {
    nav_general: "Allmänt",
    nav_rules: "Regler",
    btn_import: "Importera",
    btn_export: "Exportera",
    btn_save: "Spara",
    section_unmatched: "Omatchade filer",
    desc_unmatched: "Hur hanterar man filer som inte matchar några regler?",
    label_action: "Åtgärd",
    opt_root: "Behåll i rotmappen",
    opt_folder: "Flytta till mapp",
    label_folder_name: "Mappnamn",
    desc_rules: "Klicka för att redigera. Omatchade filer följer allmänna inställningar.",
    btn_add_rule: "Lägg till kategori",
    modal_edit_title: "Redigera kategori",
    modal_add_title: "Lägg till kategori",
    label_name: "Visningsnamn",
    label_folder: "Mappsökväg",
    label_exts: "Tillägg (kommaavgränsade)",
    tip_folder: "Sparad i: Downloads/Mapp/",
    tip_exts: "t.ex: jpg, png, gif",
    btn_delete: "Ta bort",
    btn_cancel: "Avbryt",
    btn_confirm: "Bekräfta",
    msg_saved: "Inställningar sparade",
    msg_imported: "Importerades",
    msg_import_err: "Import misslyckades",
    rule_Images: "Bilder",
    rule_Documents: "Dokument",
    rule_Videos: "Videor",
    rule_Audio: "Musik",
    rule_Archives: "Arkiv",
    rule_Apps: "Applikationer"
  },
  "hi": {
    nav_general: "सामान्य",
    nav_rules: "नियम",
    btn_import: "आयात",
    btn_export: "निर्यात",
    btn_save: "सहेजें",
    section_unmatched: "बेमेल फाइलें",
    desc_unmatched: "उन फाइलों को कैसे संभालें जो किसी नियम से मेल नहीं खातीं?",
    label_action: "कार्रवाई",
    opt_root: "रूट फोल्डर में रखें",
    opt_folder: "फोल्डर में ले जाएं",
    label_folder_name: "फोल्डर का नाम",
    desc_rules: "संपादित करने के लिए क्लिक करें। बेमेल फाइलें सामान्य सेटिंग्स का पालन करती हैं।",
    btn_add_rule: "श्रेणी जोड़ें",
    modal_edit_title: "श्रेणी संपादित करें",
    modal_add_title: "श्रेणी जोड़ें",
    label_name: "प्रदर्शन नाम",
    label_folder: "फोल्डर पथ",
    label_exts: "एक्सटेंशन (अल्पविराम से अलग)",
    tip_folder: "सहेजा गया: Downloads/Folder/",
    tip_exts: "जैसे: jpg, png, gif",
    btn_delete: "हटाएं",
    btn_cancel: "रद्द करें",
    btn_confirm: "पुष्टि करें",
    msg_saved: "सेटिंग्स सहेजी गईं",
    msg_imported: "सफलतापूर्वक आयात किया गया",
    msg_import_err: "आयात विफल",
    rule_Images: "छवियां",
    rule_Documents: "दस्तावेज़",
    rule_Videos: "वीडियो",
    rule_Audio: "संगीत",
    rule_Archives: "अभिलेखागार",
    rule_Apps: "अनुप्रयोग"
  },
  "el": {
    nav_general: "Γενικά",
    nav_rules: "Κανόνες",
    btn_import: "Εισαγωγή",
    btn_export: "Εξαγωγή",
    btn_save: "Αποθήκευση",
    section_unmatched: "Αταίριαστα αρχεία",
    desc_unmatched: "Πώς να χειριστείτε αρχεία που δεν ταιριάζουν με κανέναν κανόνα;",
    label_action: "Ενέργεια",
    opt_root: "Παραμονή στον ριζικό φάκελο",
    opt_folder: "Μετακίνηση σε φάκελο",
    label_folder_name: "Όνομα φακέλου",
    desc_rules: "Κάντε κλικ για επεξεργασία. Τα αταίριαστα αρχεία ακολουθούν τις γενικές ρυθμίσεις.",
    btn_add_rule: "Προσθήκη κατηγορίας",
    modal_edit_title: "Επεξεργασία κατηγορίας",
    modal_add_title: "Προσθήκη κατηγορίας",
    label_name: "Όνομα εμφάνισης",
    label_folder: "Διαδρομή φακέλου",
    label_exts: "Επεκτάσεις (διαχωρισμένες με κόμμα)",
    tip_folder: "Αποθηκεύτηκε σε: Downloads/Φάκελος/",
    tip_exts: "π.χ. jpg, png, gif",
    btn_delete: "Διαγραφή",
    btn_cancel: "Ακύρωση",
    btn_confirm: "Επιβεβαίωση",
    msg_saved: "Οι ρυθμίσεις αποθηκεύτηκαν",
    msg_imported: "Επιτυχής εισαγωγή",
    msg_import_err: "Η εισαγωγή απέτυχε",
    rule_Images: "Εικόνες",
    rule_Documents: "Έγγραφα",
    rule_Videos: "Βίντεο",
    rule_Audio: "Μουσική",
    rule_Archives: "Αρχεία",
    rule_Apps: "Εφαρμογές"
  }
};

// 默认数据
const defaultRules = [
  { 
    id: "Images", 
    label: "Images", 
    folder: "Images", 
    exts: ["png", "jpg", "jpeg", "webp", "gif", "svg", "ico", "heic"], 
    builtin: true 
  },
  { 
    id: "Documents", 
    label: "Documents", 
    folder: "Documents", 
    exts: ["pdf", "doc", "docx", "xls", "xlsx", "ppt", "pptx", "txt", "md", "csv"], 
    builtin: true 
  },
  { 
    id: "Videos", 
    label: "Videos", 
    folder: "Videos", 
    exts: ["mp4", "mov", "mkv", "webm", "avi"], 
    builtin: true 
  },
  { 
    id: "Audio", 
    label: "Music", 
    folder: "Music", 
    exts: ["mp3", "wav", "ogg", "flac", "m4a"], 
    builtin: true 
  },
  { 
    id: "Archives", 
    label: "Archives", 
    folder: "Archives", 
    exts: ["zip", "rar", "7z", "tar", "gz", "iso"], 
    builtin: true 
  },
  { 
    id: "Apps", 
    label: "Applications", 
    folder: "Apps", 
    exts: ["exe", "dmg", "pkg", "msi", "apk", "deb"], 
    builtin: true 
  }
];

let currentConfig = {
  version: 1,
  language: "zh-CN", // 默认中文
  rules: JSON.parse(JSON.stringify(defaultRules)),
  unmatchedAction: "others",
  unmatchedFolder: "Others"
};

// DOM 元素引用
const els = {
  tabs: document.querySelectorAll('.nav-item'),
  sections: document.querySelectorAll('.tab-content'),
  pageTitle: document.getElementById('pageTitle'),
  langSelect: document.getElementById('languageSelect'),
  unmatchedAction: document.getElementById('unmatchedAction'),
  unmatchedFolderRow: document.getElementById('unmatchedFolderRow'),
  unmatchedFolder: document.getElementById('unmatchedFolder'),
  rulesGrid: document.getElementById('rulesGrid'),
  modal: document.getElementById('editModal'),
  modalTitle: document.getElementById('modalTitle'),
  inputs: {
    id: document.getElementById('editId'),
    label: document.getElementById('editLabel'),
    folder: document.getElementById('editFolder'),
    exts: document.getElementById('editExts')
  },
  btns: {
    save: document.getElementById('saveBtn'),
    import: document.getElementById('importBtn'),
    export: document.getElementById('exportBtn'),
    addRule: document.getElementById('addRuleBtn'),
    closeModal: document.getElementById('closeModal'),
    cancelModal: document.getElementById('cancelModalBtn'),
    confirmModal: document.getElementById('confirmModalBtn'),
    deleteRule: document.getElementById('deleteRuleBtn')
  }
};

document.addEventListener('DOMContentLoaded', init);

function init() {
  loadConfig();
  setupEventListeners();
}

function loadConfig() {
  chrome.storage.local.get(['rulesConfig'], (result) => {
    if (result.rulesConfig) {
      currentConfig = { ...currentConfig, ...result.rulesConfig };
    }
    applyLanguage(currentConfig.language);
    renderUI();
  });
}

function setupEventListeners() {
  // Tab 切换
  els.tabs.forEach(tab => {
    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
  });

  // 语言切换
  els.langSelect.addEventListener('change', (e) => {
    currentConfig.language = e.target.value;
    applyLanguage(currentConfig.language);
    renderUI(); // 重新渲染卡片以更新分类名称
    saveConfig(true); // 自动静默保存
  });

  // 常规设置联动
  els.unmatchedAction.addEventListener('change', toggleUnmatchedFolder);

  // 按钮事件
  els.btns.save.addEventListener('click', saveConfig);
  els.btns.addRule.addEventListener('click', () => openModal()); // 空参数表示新增
  els.btns.closeModal.addEventListener('click', closeModal);
  els.btns.cancelModal.addEventListener('click', closeModal);
  els.btns.confirmModal.addEventListener('click', saveRuleFromModal);
  els.btns.deleteRule.addEventListener('click', deleteRuleFromModal);
  
  // 导入导出
  els.btns.export.addEventListener('click', exportRules);
  els.btns.import.addEventListener('click', () => document.getElementById('importFile').click());
  document.getElementById('importFile').addEventListener('change', importRules);
}

// --- UI 渲染逻辑 ---

function renderUI() {
  // 填充常规设置
  els.langSelect.value = currentConfig.language;
  els.unmatchedAction.value = currentConfig.unmatchedAction || "others";
  els.unmatchedFolder.value = currentConfig.unmatchedFolder || "Others";
  toggleUnmatchedFolder();

  // 渲染规则网格
  els.rulesGrid.innerHTML = '';
  currentConfig.rules.forEach((rule, index) => {
    const card = document.createElement('div');
    card.className = 'rule-card';
    card.onclick = () => openModal(index);
    
    // 获取多语言标签
    const t = i18n[currentConfig.language];
    // 兼容旧数据的 builtin 判断：如果 builtin 未定义但 ID 在默认列表中，也视为内置
    const isBuiltin = rule.builtin !== false && ['Images', 'Documents', 'Videos', 'Audio', 'Archives', 'Apps'].includes(rule.id);
    const ruleLabel = (isBuiltin && t[`rule_${rule.id}`]) ? t[`rule_${rule.id}`] : rule.label;

    // 关键修改：不再截取前6个，而是映射所有后缀 
    // 如果后缀实在太多（比如超过20个），可以考虑切片，但一般情况下全部显示更好 
    const tags = rule.exts.map(ext => `<span class="ext-tag">.${ext}</span>`).join(''); 
    
    // 移除 "more" 变量，因为我们现在全展示了 
    
    card.innerHTML = ` 
      <div class="rule-card-header"> 
        <span class="rule-name">${ruleLabel}</span> 
        <span class="rule-folder">/${rule.folder}</span> 
      </div> 
      <div class="rule-tags">${tags}</div> 
    `;
    els.rulesGrid.appendChild(card);
  });
}

function switchTab(tabName) {
  // 更新侧边栏
  els.tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
  // 更新内容区
  els.sections.forEach(s => s.classList.toggle('active', s.id === `tab-${tabName}`));
  
  // 更新标题
  const lang = currentConfig.language;
  const titleKey = tabName === 'general' ? 'nav_general' : 'nav_rules';
  els.pageTitle.textContent = i18n[lang][titleKey];
}

function toggleUnmatchedFolder() {
  const show = els.unmatchedAction.value === 'others';
  els.unmatchedFolderRow.style.display = show ? 'block' : 'none';
}

// --- 多语言逻辑 ---

function applyLanguage(lang) {
  const t = i18n[lang] || i18n['en'];
  
  // RTL support for Arabic
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (t[key]) el.textContent = t[key];
  });
  // 更新 placeholder
  if(lang === 'zh-CN') {
     els.inputs.label.placeholder = "例如：设计素材";
     els.inputs.folder.placeholder = "Design/Assets";
  } else {
     els.inputs.label.placeholder = "e.g. Design Assets";
     els.inputs.folder.placeholder = "Design/Assets";
  }
}

// --- Modal 逻辑 ---

function openModal(ruleIndex = null) {
  const isEdit = ruleIndex !== null;
  const lang = currentConfig.language;
  const t = i18n[lang];

  els.modal.classList.remove('hidden');
  els.modalTitle.textContent = isEdit ? t.modal_edit_title : t.modal_add_title;
  
  if (isEdit) {
    const rule = currentConfig.rules[ruleIndex];
    els.inputs.id.value = ruleIndex; // 临时存索引
    
    // 编辑时也显示翻译后的名称
    const isBuiltin = rule.builtin !== false && ['Images', 'Documents', 'Videos', 'Audio', 'Archives', 'Apps'].includes(rule.id);
    els.inputs.label.value = (isBuiltin && t[`rule_${rule.id}`]) ? t[`rule_${rule.id}`] : rule.label;
    
    els.inputs.folder.value = rule.folder;
    els.inputs.exts.value = rule.exts.join(', ');
    els.btns.deleteRule.style.display = 'block';
  } else {
    els.inputs.id.value = "new";
    els.inputs.label.value = "";
    els.inputs.folder.value = "";
    els.inputs.exts.value = "";
    els.btns.deleteRule.style.display = 'none';
  }
}

function closeModal() {
  els.modal.classList.add('hidden');
}

function saveRuleFromModal() {
  const index = els.inputs.id.value;
  const newRule = {
    id: index === "new" ? `custom_${Date.now()}` : currentConfig.rules[index].id,
    label: els.inputs.label.value.trim() || "未命名",
    folder: els.inputs.folder.value.trim() || "Unsorted",
    exts: els.inputs.exts.value.split(/[,，]/).map(s => s.trim().toLowerCase()).filter(Boolean),
    builtin: false // 编辑后视为自定义
  };

  if (index === "new") {
    currentConfig.rules.push(newRule);
  } else {
    currentConfig.rules[index] = newRule;
  }
  
  closeModal();
  renderUI();
  // 注意：这里只是更新了内存和UI，用户需要点“保存所有”才会持久化，或者你可以这里自动保存
  saveConfig(true); 
}

function deleteRuleFromModal() {
  const index = els.inputs.id.value;
  if (index !== "new") {
    currentConfig.rules.splice(index, 1);
    closeModal();
    renderUI();
    saveConfig(true);
  }
}

// --- 核心功能 ---

function saveConfig(silent = false) {
  // 收集常规设置
  currentConfig.unmatchedAction = els.unmatchedAction.value;
  currentConfig.unmatchedFolder = els.unmatchedFolder.value;

  chrome.storage.local.set({ rulesConfig: currentConfig }, () => {
    if (!silent) showToast(i18n[currentConfig.language].msg_saved);
  });
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.opacity = '1';
  t.style.top = '40px';
  setTimeout(() => {
    t.style.opacity = '0';
    t.style.top = '20px';
  }, 2000);
}

function exportRules() {
  const blob = new Blob([JSON.stringify(currentConfig, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'smart-dl-config.json';
  a.click();
}

function importRules(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const parsed = JSON.parse(reader.result);
      if (parsed.rules && Array.isArray(parsed.rules)) {
        currentConfig = { ...currentConfig, ...parsed };
        // 保持语言设置不变，除非你想覆盖
        applyLanguage(currentConfig.language);
        renderUI();
        saveConfig();
        showToast(i18n[currentConfig.language].msg_imported);
      }
    } catch (e) {
      showToast(i18n[currentConfig.language].msg_import_err);
    }
  };
  reader.readAsText(file);
}